<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zolo Kombat</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #1c1f24;
            --card-bg: #2b2f36;
            --accent-gold: #f3ba2f;
            --text-primary: #ffffff;
            --text-secondary: #8b939e;
            --danger: #ff4b4b;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –í–µ—Ä—Ö–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ --- */
        .header-stats {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            background: var(--card-bg);
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .stat-box { text-align: center; }
        .stat-label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 16px; font-weight: bold; color: var(--accent-gold); margin-top: 4px; }

        /* --- –ë–∞–ª–∞–Ω—Å --- */
        .main-balance {
            flex-grow: 0;
            text-align: center;
            margin: 10px 0;
            font-size: 42px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 0 20px rgba(243, 186, 47, 0.3);
        }
        .coin-icon-small { 
            width: 36px; height: 36px; margin-right: 10px; 
            background: radial-gradient(circle, #ffd700, #f3ba2f);
            border-radius: 50%; border: 2px solid #fff;
            box-shadow: 0 0 10px #f3ba2f;
        }

        /* --- –ó–æ–Ω–∞ —Ç–∞–ø–∞ (–ò–≤–∞–Ω –ó–æ–ª–æ) --- */
        .tap-area-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        .tap-img {
            width: 260px;
            height: 260px;
            /* –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É. –ï—Å–ª–∏ –µ—Å—Ç—å —Å–≤–æ—è - –∑–∞–º–µ–Ω–∏ –Ω–∞ 'zolo.png' */
            background-image: url('https://imgur.com/a/mxuPXvg'); 
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            box-shadow: 0 0 60px rgba(243, 186, 47, 0.2);
            cursor: pointer;
            transition: transform 0.05s ease;
            image-rendering: pixelated; /* –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —Å—Ç–∏–ª—å */
            border: 4px solid rgba(255, 255, 255, 0.1);
        }
        .tap-img:active { transform: scale(0.92); }

        /* --- –≠–Ω–µ—Ä–≥–∏—è --- */
        .energy-container { padding: 0 20px; margin-bottom: 15px; }
        .energy-text { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 13px; font-weight: 600;}
        .progress-bar-bg { height: 12px; background: #3b4049; border-radius: 6px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); }
        .progress-bar-fill { height: 100%; background: linear-gradient(90deg, #f3ba2f, #ffeb3b); width: 100%; transition: width 0.2s ease-out; }

        /* --- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é --- */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            background: rgba(43, 47, 54, 0.95);
            padding: 12px 0 20px 0;
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.05);
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            width: 33%;
            transition: transform 0.1s;
        }
        .nav-item:active { transform: scale(0.9); }
        .nav-icon { font-size: 22px; margin-bottom: 4px; filter: grayscale(100%); transition: filter 0.3s; }
        .nav-item.active .nav-icon { filter: grayscale(0%); }
        .nav-item.active { color: var(--text-primary); }

        /* --- –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã --- */
        .floating-text {
            position: absolute;
            font-size: 32px;
            font-weight: 900;
            color: white;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            text-shadow: 2px 2px 0px #000;
            z-index: 20;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-120px) scale(1.2); }
        }

        #status-bar {
            position: absolute; top: 0; left: 0; width: 100%;
            text-align: center; font-size: 10px; padding: 2px;
            background: rgba(0,0,0,0.5); display: none;
        }
    </style>
</head>
<body>

    <div id="status-bar">Connecting...</div>

    <div class="header-stats">
        <div class="stat-box">
            <div class="stat-label">–î–æ—Ö–æ–¥ –≤ —á–∞—Å</div>
            <div class="stat-value">+<span id="mining-stat">0</span></div>
        </div>
        <div class="stat-box">
            <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
            <div class="stat-value">LVL <span id="level-stat">1</span></div>
        </div>
        <div class="stat-box">
            <div class="stat-label">–°–∏–ª–∞ –∫–ª–∏–∫–∞</div>
            <div class="stat-value">x<span id="multitap-stat">1</span></div>
        </div>
    </div>

    <div class="main-balance">
        <div class="coin-icon-small"></div>
        <span id="balance">Loading...</span>
    </div>

    <div class="tap-area-container">
        <div class="tap-img" id="tapBtn"></div>
    </div>

    <div class="energy-container">
        <div class="energy-text">
            <span>‚ö° Energy</span>
            <span><span id="energy">1500</span> / <span id="max-energy">1500</span></span>
        </div>
        <div class="progress-bar-bg">
            <div class="progress-bar-fill" id="energy-bar"></div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active">
            <div class="nav-icon">üêπ</div>
            <div>Tap</div>
        </div>
        <div class="nav-item" onclick="buyUpgrade('mining')">
            <div class="nav-icon">‚õèÔ∏è</div>
            <div>Mine (Buy)</div>
        </div>
        <div class="nav-item" onclick="buyUpgrade('multitap')">
            <div class="nav-icon">üöÄ</div>
            <div>Boost (Buy)</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); 
        tg.enableClosingConfirmation();

        // =================================================================
        // üëá –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–û–Æ –°–°–´–õ–ö–£ –û–¢ NGROK (https://....ngrok-free.app)
        const SERVER_URL = "https://aboba1234.pythonanywhere.com"; 
        // üëÜ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ü–†–û–í–ï–†–¨, –ß–¢–û–ë–´ –í –ö–û–ù–¶–ï –ù–ï –ë–´–õ–û –°–õ–ï–®–ê "/"
        // =================================================================

        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 99999;
        const statusBar = document.getElementById('status-bar');

        let gameState = { balance: 0, energy: 1500, multitap: 1, mining: 0 };
        let clicksQueue = 0;
        const maxEnergy = 1500;

        // –≠–ª–µ–º–µ–Ω—Ç—ã UI
        const balanceEl = document.getElementById('balance');
        const energyEl = document.getElementById('energy');
        const energyBar = document.getElementById('energy-bar');
        const multitapStat = document.getElementById('multitap-stat');
        const miningStat = document.getElementById('mining-stat');
        const tapBtn = document.getElementById('tapBtn');
        const tapContainer = document.querySelector('.tap-area-container');

        // --- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç ngrok) ---
        async function apiRequest(endpoint, body = {}) {
            try {
                const response = await fetch(`${SERVER_URL}${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'ngrok-skip-browser-warning': 'true' // <--- –≠–¢–ê –°–¢–†–û–ö–ê –†–ï–®–ê–ï–¢ –ü–†–û–ë–õ–ï–ú–£
                    },
                    body: JSON.stringify({ user_id: userId, ...body })
                });

                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error("API Error:", error);
                statusBar.style.display = 'block';
                statusBar.style.background = 'red';
                statusBar.innerText = "Connection lost. Reconnecting...";
                return null;
            }
        }

        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        async function initGame() {
            const data = await apiRequest('/api/init');
            if (data) {
                gameState = data;
                updateUI();
                statusBar.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞
                
                if(data.profit_afk > 0) {
                    tg.showAlert(`–ü–æ–∫–∞ —Ç–µ–±—è –Ω–µ –±—ã–ª–æ, –ó–æ–ª–æ –Ω–∞–º–∞–π–Ω–∏–ª: ${data.profit_afk} –º–æ–Ω–µ—Ç!`);
                }
            } else {
                balanceEl.innerText = "Error";
            }
        }

        // 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ (Optimistic UI)
        tapBtn.addEventListener('click', (e) => {
            if (gameState.energy > 0) {
                // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –Ω–µ –æ–∂–∏–¥–∞—è —Å–µ—Ä–≤–µ—Ä–∞
                gameState.balance += gameState.multitap;
                gameState.energy -= 1;
                clicksQueue++;
                
                updateUI();
                tg.HapticFeedback.impactOccurred('medium'); // –í–∏–±—Ä–∞—Ü–∏—è
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –≤—ã–ª–µ—Ç–∞—é—â–∏—Ö —Ü–∏—Ñ—Ä
                showFloatingText(e.clientX, e.clientY, `+${gameState.multitap}`);
            } else {
                tg.HapticFeedback.notificationOccurred('error'); // –í–∏–±—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏
            }
        });

        // 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∏–∫–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∫–∞–∂–¥—ã–µ 1.5 —Å–µ–∫)
        setInterval(async () => {
            if (clicksQueue > 0) {
                const toSend = clicksQueue;
                clicksQueue = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—á–µ—Ä–µ–¥—å
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —Ñ–æ–Ω–µ
                await apiRequest('/api/tap', { clicks: toSend });
            }
        }, 1500);

        // 4. –ü–æ–∫—É–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π
        async function buyUpgrade(type) {
            tg.HapticFeedback.selectionChanged();
            
            // –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å)
            const confirm = true; 
            
            if (confirm) {
                const result = await apiRequest('/api/buy', { type: type });
                if (result && result.status === 'ok') {
                    tg.HapticFeedback.notificationOccurred('success');
                    initGame(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
                } else {
                    tg.HapticFeedback.notificationOccurred('error');
                    tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!");
                }
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function updateUI() {
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–∞ (1 000 000)
            balanceEl.innerText = gameState.balance.toLocaleString();
            energyEl.innerText = gameState.energy;
            multitapStat.innerText = gameState.multitap;
            miningStat.innerText = (gameState.mining * 3600).toLocaleString(); // –î–æ—Ö–æ–¥ –≤ —á–∞—Å
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ—Å–∫—É —ç–Ω–µ—Ä–≥–∏–∏
            const percentage = Math.max(0, (gameState.energy / maxEnergy) * 100);
            energyBar.style.width = percentage + "%";
            
            // –ï—Å–ª–∏ —ç–Ω–µ—Ä–≥–∏–∏ –º–∞–ª–æ - –∫—Ä–∞—Å–∏–º –ø–æ–ª–æ—Å–∫—É –≤ –∫—Ä–∞—Å–Ω—ã–π
            energyBar.style.background = percentage < 20 
                ? 'linear-gradient(90deg, #ff4b4b, #ff7e7e)' 
                : 'linear-gradient(90deg, #f3ba2f, #ffeb3b)';
        }

        function showFloatingText(x, y, text) {
            const el = document.createElement('div');
            el.className = 'floating-text';
            el.innerText = text;
            // –†–∞–Ω–¥–æ–º–Ω—ã–π —Ä–∞–∑–±—Ä–æ—Å, —á—Ç–æ–±—ã —Ü–∏—Ñ—Ä—ã –Ω–µ —Å–ª–∏–ø–∞–ª–∏—Å—å
            const randomX = (Math.random() - 0.5) * 40;
            el.style.left = (x + randomX) + 'px';
            el.style.top = (y - 50) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        // –ó–∞–ø—É—Å–∫!
        initGame();
        
        // –ê–≤—Ç–æ-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ (–≤–∏–∑—É–∞–ª—å–Ω–æ)
        setInterval(() => {
            if (gameState.energy < maxEnergy) {
                gameState.energy += 1; // –ü—Ä–æ—Å—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω–æ, —Å–µ—Ä–≤–µ—Ä —Å–∞–º –ø–æ—Å—á–∏—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
                updateUI();
            }
        }, 1000);

    </script>
</body>
</html>


