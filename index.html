<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zolo Kombat RGB</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-grad: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            --card-bg: rgba(255, 255, 255, 0.08);
            --accent-gold: #ffd700;
            --accent-green: #00e676;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
        }

        body {
            margin: 0; padding: 0;
            background: var(--bg-grad);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite; /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω */
            color: var(--text-primary);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            height: 100vh; overflow: hidden;
            display: flex; flex-direction: column;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        @keyframes gradientBG { 
            0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} 
        }

        .screen { display: none; height: 100%; flex-direction: column; padding: 20px; overflow-y: auto; box-sizing: border-box; }
        .screen.active { display: flex; }

        /* HEADER STATS - –ö–†–£–ü–ù–ï–ï */
        .stats-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;
            background: var(--card-bg); padding: 15px; border-radius: 20px; margin-bottom: 25px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-item { text-align: center; }
        .stat-label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
        .stat-val { font-size: 18px; font-weight: 800; color: var(--accent-gold); margin-top: 5px; }

        /* BIG BALANCE */
        .balance-container { text-align: center; margin: 10px 0 30px 0; }
        .balance-val { font-size: 56px; font-weight: 900; text-shadow: 0 0 25px rgba(255, 215, 0, 0.5); letter-spacing: -2px; }

        /* TAP AREA - –ü–ê–°–•–ê–õ–ö–ê */
        .tap-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; }
        .tap-btn {
            width: 290px; height: 290px;
            background-image: url('https://i.imgur.com/8QlqWkH.png');
            background-size: cover; border-radius: 50%;
            box-shadow: 0 0 80px rgba(255, 215, 0, 0.3);
            transition: transform 0.05s, filter 0.2s;
            cursor: pointer; border: 6px solid rgba(255,255,255,0.15);
        }
        .tap-btn:active { transform: scale(0.92); }
        .tap-btn.glitch { filter: hue-rotate(90deg) contrast(200%); } /* –≠—Ñ—Ñ–µ–∫—Ç –ø–∞—Å—Ö–∞–ª–∫–∏ */

        /* ENERGY */
        .energy-bar-container { height: 14px; background: rgba(0,0,0,0.4); border-radius: 7px; margin: 10px 20px; overflow: hidden; }
        .energy-fill { height: 100%; background: linear-gradient(90deg, #ff9800, #ffeb3b); width: 100%; transition: width 0.2s; }

        /* UPGRADES LIST */
        .upgrade-item {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--card-bg); padding: 18px; margin-bottom: 15px; border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(5px);
        }
        .upgrade-info h4 { margin: 0; font-size: 18px; color: #fff; }
        .upgrade-info p { margin: 6px 0 0; font-size: 13px; color: var(--text-secondary); }
        .model-name { color: var(--accent-green); font-weight: bold; font-size: 14px; }
        
        .buy-btn {
            padding: 10px 20px; border-radius: 10px; font-weight: bold; font-size: 14px;
            background: rgba(255,255,255,0.1); color: #777; border: none; cursor: default;
            min-width: 90px; text-align: center;
        }
        .buy-btn.can-buy {
            background: linear-gradient(135deg, var(--accent-green), #00b894);
            color: #000; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 230, 118, 0.3);
        }
        .buy-btn.can-buy:active { transform: scale(0.95); }

        /* LISTS */
        .list-item {
            display: flex; justify-content: space-between; padding: 18px;
            background: var(--card-bg); margin-bottom: 10px; border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.05); align-items: center;
        }
        .rank-num { font-weight: bold; color: var(--accent-gold); width: 30px; font-size: 18px; }
        .user-name { font-weight: bold; color: white; font-size: 16px; }

        .daily-btn {
            width: 100%; padding: 25px; background: linear-gradient(45deg, #ff0099, #493240);
            border: none; border-radius: 18px; color: white; font-weight: bold; font-size: 20px;
            margin-bottom: 25px; cursor: pointer; opacity: 0.6; pointer-events: none;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); text-transform: uppercase;
        }
        .daily-btn.active { 
            opacity: 1; pointer-events: auto; 
            background: linear-gradient(45deg, #ff00cc, #333399);
            animation: pulse 2s infinite; 
        }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.02);} 100% {transform: scale(1);} }

        /* NAV */
        .bottom-nav {
            display: flex; justify-content: space-around; background: rgba(0,0,0,0.8);
            padding: 15px 0 30px; border-top: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
        }
        .nav-btn {
            display: flex; flex-direction: column; align-items: center; color: var(--text-secondary);
            font-size: 12px; cursor: pointer; transition: 0.2s; width: 33%;
        }
        .nav-btn.active { color: white; transform: translateY(-5px); text-shadow: 0 0 10px white; }
        .nav-icon { font-size: 28px; margin-bottom: 6px; }

        .float-text { position: absolute; color: white; font-weight: 900; font-size: 32px; animation: floatUp 0.8s forwards; pointer-events: none; text-shadow: 2px 2px 0 #000; }
        @keyframes floatUp { to { transform: translateY(-120px) rotate(10deg); opacity: 0; } }

        #error-toast {
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
            background: #ff4b4b; color: white; padding: 12px 25px; border-radius: 30px;
            font-size: 14px; display: none; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,0.5); font-weight: bold;
        }
        
        h2 { font-size: 28px; margin-bottom: 20px; text-shadow: 0 0 10px rgba(255,255,255,0.2); }
    </style>
</head>
<body>

    <div id="error-toast">üì° Connection Lost...</div>

    <div id="screen-game" class="screen active">
        <h2 style="text-align:center; font-size:14px; opacity:0.5;" id="title-header">ZOLO KOMBAT</h2>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">–ú–∞–π–Ω–∏–Ω–≥/—á–∞—Å</div>
                <div class="stat-val">+<span id="mining-stat">0</span></div>
            </div>
            <div class="stat-item" id="energy-click">
                <div class="stat-label">–≠–Ω–µ—Ä–≥–∏—è</div>
                <div class="stat-val"><span id="energy">1500</span></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">CPU</div>
                <div class="stat-val"><span id="cpu-name">Pentium</span></div>
            </div>
        </div>

        <div class="balance-container">
            <div class="balance-val" id="balance">0</div>
        </div>

        <div class="tap-area">
            <div class="tap-btn" id="tapBtn"></div>
        </div>

        <div class="energy-bar-container">
            <div class="energy-fill" id="energy-bar"></div>
        </div>
    </div>

    <div id="screen-earn" class="screen">
        <h2>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω –ñ–µ–ª–µ–∑–∞</h2>
        
        <button id="daily-btn" class="daily-btn" onclick="claimDaily()">üéÅ –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>

        <div class="upgrade-item">
            <div class="upgrade-info">
                <h4>–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä (–ö–ª–∏–∫)</h4>
                <div class="model-name" id="next-cpu">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <p>–ú–æ—â–Ω–µ–µ –ø—Ä–æ—Ü - —Å–∏–ª—å–Ω–µ–µ –∫–ª–∏–∫</p>
            </div>
            <button class="buy-btn" id="btn-multi" onclick="buy('multitap')">200</button>
        </div>

        <div class="upgrade-item">
            <div class="upgrade-info">
                <h4>–í–∏–¥–µ–æ–∫–∞—Ä—Ç–∞ (–ú–∞–π–Ω–∏–Ω–≥)</h4>
                <div class="model-name" id="next-gpu">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <p>–ú–∞–π–Ω–∏—Ç –∫—Ä–∏–ø—Ç—É –ø–æ–∫–∞ —Ç—ã —Å–ø–∏—à—å</p>
            </div>
            <button class="buy-btn" id="btn-mine" onclick="buy('mining')">1000</button>
        </div>
    </div>

    <div id="screen-social" class="screen">
        <h2>üíé –¢–≤–æ—è –ë–∞–Ω–¥–∞</h2>
        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 16px; margin-bottom: 30px; text-align:center;">
            <p style="font-size:16px;">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ –∏ –ø–æ–ª—É—á–∏ <b>5,000 –º–æ–Ω–µ—Ç</b>!</p>
            <button class="buy-btn can-buy" style="width:100%; padding:15px; font-size:16px;" onclick="inviteFriend()">üîó –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
        </div>

        <h2>üèÜ –¢–æ–ø –ú–∞–≥–Ω–∞—Ç–æ–≤</h2>
        <div id="leaderboard-list">
            <div style="text-align:center; color:#777">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞...</div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-btn active" onclick="switchTab('game', this)">
            <div class="nav-icon">üéÆ</div>
            <div>–ë–∞–∑–∞</div>
        </div>
        <div class="nav-btn" onclick="switchTab('earn', this)">
            <div class="nav-icon">üõí</div>
            <div>–ê–ø–≥—Ä–µ–π–¥</div>
        </div>
        <div class="nav-btn" onclick="switchTab('social', this)">
            <div class="nav-icon">üèÜ</div>
            <div>–¢–æ–ø</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // ==========================================
        // üëá –¢–í–û–Ø –°–°–´–õ–ö–ê üëá
        const SERVER_URL = "https://aboba1234.pythonanywhere.com"; 
        // ==========================================

        const user = tg.initDataUnsafe.user;
        const userId = user ? user.id : 12345;
        const username = user ? (user.username ? `@${user.username}` : user.first_name) : "Gamer";
        const startParam = tg.initDataUnsafe.start_param || null;

        let gameState = { balance: 0, energy: 1500, multitap: 1, mining: 0, daily_amount: 5000 };
        let clicksQueue = 0;
        let failCount = 0; // –î–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç Connection Lost

        // --- –õ–û–† –ò–ì–†–´ (–ù–ê–ó–í–ê–ù–ò–Ø) ---
        const cpuNames = ["Pentium 2", "Celeron", "Core 2 Duo", "Core i3", "Core i5", "Core i7", "Core i9", "Ryzen 9", "Threadripper", "Quantum CPU", "Alien Tech"];
        const gpuNames = ["Integrated", "Riva TNT", "GeForce 256", "MX 440", "GT 9800", "GTX 660", "GTX 1080", "RTX 3060", "RTX 4090", "H100 Cluster", "Dyson Sphere"];

        const els = {
            balance: document.getElementById('balance'),
            energy: document.getElementById('energy'),
            energyBar: document.getElementById('energy-bar'),
            cpuName: document.getElementById('cpu-name'),
            mineStat: document.getElementById('mining-stat'),
            btnMulti: document.getElementById('btn-multi'),
            btnMine: document.getElementById('btn-mine'),
            nextCpu: document.getElementById('next-cpu'),
            nextGpu: document.getElementById('next-gpu'),
            dailyBtn: document.getElementById('daily-btn'),
            errorToast: document.getElementById('error-toast')
        };

        async function apiRequest(endpoint, body = {}) {
            try {
                const res = await fetch(`${SERVER_URL}${endpoint}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ user_id: userId, ...body })
                });

                if (res.status === 400) {
                    const err = await res.json();
                    tg.showAlert(err.error || "–û—à–∏–±–∫–∞");
                    return null;
                }
                if (!res.ok) throw new Error("Network");
                
                // –£—Å–ø–µ—Ö - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
                failCount = 0;
                els.errorToast.style.display = 'none';
                return await res.json();

            } catch (e) {
                console.error(e);
                failCount++;
                // –ü–û–ö–ê–ó–´–í–ê–ï–ú –û–®–ò–ë–ö–£ –¢–û–õ–¨–ö–û –ü–û–°–õ–ï 3 –ù–ï–£–î–ê–ß (debounce)
                if (failCount > 3) {
                    els.errorToast.style.display = 'block';
                }
                return null;
            }
        }

        async function initGame() {
            const data = await apiRequest('/api/init', { username: username, start_param: startParam });
            if (data) {
                gameState = data;
                updateUI();
                
                if (data.can_claim_daily) {
                    els.dailyBtn.classList.add('active');
                    els.dailyBtn.innerText = `üéÅ –ó–ê–ë–†–ê–¢–¨ +${formatNum(data.daily_amount)}`;
                } else {
                    els.dailyBtn.classList.remove('active');
                    els.dailyBtn.innerText = "‚è≥ –ñ–¥–∏ 24—á";
                }
                if (data.profit_afk > 0) tg.showAlert(`–ü–æ–∫–∞ —Ç—ã —Å–ø–∞–ª, —Ñ–µ—Ä–º–∞ –Ω–∞–º–∞–π–Ω–∏–ª–∞: +${formatNum(data.profit_afk)}`);
            }
        }

        document.getElementById('tapBtn').addEventListener('click', (e) => {
            if (gameState.energy > 0) {
                gameState.balance += gameState.multitap;
                gameState.energy--;
                clicksQueue++;
                updateUI();
                
                const float = document.createElement('div');
                float.className = 'float-text';
                float.innerText = '+' + gameState.multitap;
                float.style.left = e.clientX + 'px';
                float.style.top = e.clientY - 50 + 'px';
                document.body.appendChild(float);
                setTimeout(() => float.remove(), 800);
                
                tg.HapticFeedback.impactOccurred('medium');
            }
        });

        // –ü–ê–°–•–ê–õ–ö–ê 1: –ö–ª–∏–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É
        let titleClicks = 0;
        document.getElementById('title-header').addEventListener('click', () => {
            titleClicks++;
            if (titleClicks === 5) {
                tg.showAlert("–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞: –ê–ö–¢–ò–í–ò–†–û–í–ê–ù (–®—É—Ç–∫–∞)");
                document.getElementById('tapBtn').classList.add('glitch');
            }
        });

        // –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ú–ê–ô–ù–ò–ù–ì–ê –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò
        setInterval(() => {
            if (gameState.mining > 0) {
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ—Ö–æ–¥ –≤ —Å–µ–∫—É–Ω–¥—É
                gameState.balance += gameState.mining;
                updateUI();
            }
        }, 1000);

        setInterval(async () => {
            if (clicksQueue > 0) {
                const toSend = clicksQueue; clicksQueue = 0;
                await apiRequest('/api/tap', { clicks: toSend });
            }
        }, 3000); // –†–µ–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º, —á—Ç–æ–±—ã –Ω–µ –≥—Ä—É–∑–∏—Ç—å —Å–µ—Ç—å

        async function buy(type) {
            let price = (type === 'multitap') ? 200 * gameState.multitap : 1000 * (gameState.mining + 1);
            if (gameState.balance < price) {
                tg.HapticFeedback.notificationOccurred('error');
                tg.showAlert("–ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –∑–æ–ª–æ—Ç–∞!"); 
                return;
            }
            const res = await apiRequest('/api/buy', { type: type });
            if (res && res.status === 'ok') {
                tg.HapticFeedback.notificationOccurred('success');
                initGame(); 
            }
        }

        async function claimDaily() {
            const res = await apiRequest('/api/daily');
            if (res && res.status === 'ok') {
                tg.HapticFeedback.notificationOccurred('success');
                tg.showAlert(`–ü–æ–ª—É—á–µ–Ω–æ: ${formatNum(res.reward)} –º–æ–Ω–µ—Ç!`);
                initGame();
            }
        }

        function inviteFriend() {
            const link = `https://t.me/SuperZoloBot?start=${userId}`;
            const text = `–Ø —Å–æ–±—Ä–∞–ª –ü–ö –Ω–∞ RTX 4090 –≤ Zolo Kombat! –ó–∞–ª–µ—Ç–∞–π üëá`;
            const url = `https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}`;
            tg.openTelegramLink(url);
        }

        async function loadLeaderboard() {
            try {
                const res = await fetch(`${SERVER_URL}/api/leaderboard`);
                const users = await res.json();
                const list = document.getElementById('leaderboard-list');
                list.innerHTML = "";
                users.forEach((u, i) => {
                    let medal = i === 0 ? 'ü•á' : (i === 1 ? 'ü•à' : (i === 2 ? 'ü•â' : `#${i+1}`));
                    list.innerHTML += `
                        <div class="list-item">
                            <span class="rank-num">${medal}</span>
                            <span class="user-name">${u.name || '–ê–Ω–æ–Ω–∏–º'}</span>
                            <span style="color:gold; font-weight:bold;">${formatNum(u.balance)}</span>
                        </div>`;
                });
            } catch (e) { console.error(e); }
        }

        function updateUI() {
            els.balance.innerText = Math.floor(gameState.balance).toLocaleString();
            els.energy.innerText = Math.floor(gameState.energy);
            
            // –ù–∞–∑–≤–∞–Ω–∏—è –∂–µ–ª–µ–∑–∞
            els.cpuName.innerText = cpuNames[gameState.multitap - 1] || "Alien Tech";
            els.nextCpu.innerText = "–ê–ø–≥—Ä–µ–π–¥ –¥–æ: " + (cpuNames[gameState.multitap] || "MAX");
            
            els.nextGpu.innerText = "–ö—É–ø–∏—Ç—å: " + (gpuNames[gameState.mining + 1] || "MAX");

            els.mineStat.innerText = formatNum(gameState.mining * 3600);
            
            const pct = (gameState.energy / 1500) * 100;
            els.energyBar.style.width = pct + "%";

            updateBtn(els.btnMulti, 200 * gameState.multitap);
            updateBtn(els.btnMine, 1000 * (gameState.mining + 1));
        }

        function updateBtn(btn, price) {
            btn.innerText = formatNum(price);
            if (gameState.balance >= price) {
                btn.classList.add('can-buy');
            } else {
                btn.classList.remove('can-buy');
            }
        }

        function formatNum(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
            return num;
        }

        function switchTab(tab, btn) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-' + tab).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if (tab === 'social') loadLeaderboard();
        }

        initGame();
        
        setInterval(() => {
            if (gameState.energy < 1500) { gameState.energy++; updateUI(); }
        }, 1000);
    </script>
</body>
</html>
