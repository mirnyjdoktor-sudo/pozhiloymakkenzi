<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zolo Debugger</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; word-wrap: break-word; }
        h1 { color: #fff; }
        .box { border: 1px solid #333; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .error { color: #ff3333; font-weight: bold; }
        .success { color: #33ff33; font-weight: bold; }
        button { padding: 15px; width: 100%; font-size: 18px; background: #333; color: white; border: none; cursor: pointer; margin-bottom: 20px; }
    </style>
</head>
<body>

    <h1>üîç Zolo –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h1>
    
    <div class="box">
        URL –°–µ—Ä–≤–µ—Ä–∞:<br>
        <b id="url-display">...</b>
    </div>

    <button onclick="runTest()">–ó–ê–ü–£–°–¢–ò–¢–¨ –¢–ï–°–¢</button>

    <div id="log">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É...</div>

    <script>
        // ==========================================
        // üëá –í–°–¢–ê–í–¨ –°–í–û–Æ –°–°–´–õ–ö–£ –°–Æ–î–ê (–¢–û–ß–ù–û –ö–ê–ö –ï–°–¢–¨)
        const SERVER_URL = "https://aboba1234.pythonanywhere.com"; 
        // ==========================================

        document.getElementById('url-display').innerText = SERVER_URL;
        const logEl = document.getElementById('log');

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = type === 'error' ? 'error' : (type === 'success' ? 'success' : '');
            div.style.marginBottom = "10px";
            div.innerText = `> ${msg}`;
            logEl.appendChild(div);
        }

        async function runTest() {
            logEl.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞
            log("–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç...");

            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
            if (SERVER_URL.startsWith("http://")) {
                log("–û–®–ò–ë–ö–ê: –°—Å—ã–ª–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å http://. –ê –Ω—É–∂–Ω–æ https://", "error");
                return;
            }

            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–µ—à–∞
            if (SERVER_URL.endsWith("/")) {
                log("–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: –°—Å—ã–ª–∫–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ '/'. –£–±–µ—Ä–∏ –µ–≥–æ.", "error");
            }

            try {
                log(`–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ ${SERVER_URL}/api/init ...`);
                
                const response = await fetch(`${SERVER_URL}/api/init`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: 12345 })
                });

                log(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);

                if (response.ok) {
                    const data = await response.json();
                    log("–£–°–ü–ï–•! –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:", "success");
                    log(JSON.stringify(data));
                } else {
                    const text = await response.text();
                    log(`–û–®–ò–ë–ö–ê –°–ï–†–í–ï–†–ê (${response.status}):`, "error");
                    log(text.substring(0, 100)); // –ü–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤ –æ—à–∏–±–∫–∏
                }

            } catch (error) {
                log("–û–®–ò–ë–ö–ê –°–ï–¢–ò (Fetch Error):", "error");
                log(error.message);
                log("–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã: 1. –°–µ—Ä–≤–µ—Ä –≤—ã–∫–ª—é—á–µ–Ω. 2. CORS (–Ω–µ—Ç flask-cors). 3. Mixed Content (http –≤–º–µ—Å—Ç–æ https).");
            }
        }
    </script>
</body>
</html>

